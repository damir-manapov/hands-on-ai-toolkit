services:
  ai-toolkit:
    image: ghcr.io/ostris/ai-toolkit:latest
    build:
      context: ./ai-toolkit
      dockerfile: Dockerfile
    container_name: ai-toolkit
    ports:
      - '8675:8675'
    volumes:
      - ./config:/workspace/config
      - toolkit-output:/workspace/output
      - toolkit-models:/workspace/models
    environment:
      - HF_TOKEN=${HF_TOKEN:-}
      - AI_TOOLKIT_AUTH=${AI_TOOLKIT_AUTH:-}
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
    restart: unless-stopped
    healthcheck:
      test: ['CMD', 'curl', '-sf', 'http://localhost:8675']
      interval: 15s
      timeout: 10s
      retries: 20
      start_period: 60s

volumes:
  toolkit-output:
  toolkit-models:
